<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Compatibility Chatbot Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'gradient': 'gradient 8s ease infinite',
                        'pulse-slow': 'pulse 2s ease-in-out infinite',
                        'bounce-slow': 'bounce 2s ease-in-out infinite',
                    },
                    keyframes: {
                        gradient: {
                            '0%, 100%': { 'background-position': '0% 50%' },
                            '50%': { 'background-position': '100% 50%' }
                        }
                    },
                    backgroundSize: {
                        '400': '400% 400%'
                    }
                }
            }
        }
    </script>
    <style>
        .bg-size-400 { background-size: 400% 400%; }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 bg-size-400 animate-gradient">
    <div class="container mx-auto p-4 lg:p-6 min-h-screen grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        <!-- Header -->
        <header class="lg:col-span-3 text-center bg-white/90 backdrop-blur-md p-8 rounded-2xl shadow-xl border border-white/20">
            <h1 class="text-4xl lg:text-5xl font-bold bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 bg-clip-text text-transparent mb-4">
                Family Compatibility Chatbot
            </h1>
            <p class="text-xl text-slate-600 mb-6">
                Intentional Family Planning Through AI-Powered Matching
            </p>
            
            <!-- Progress Bar -->
            <div class="max-w-md mx-auto">
                <div class="w-full bg-slate-200 rounded-full h-3 mb-3">
                    <div id="progressBar" class="bg-gradient-to-r from-indigo-500 to-purple-500 h-3 rounded-full transition-all duration-500 ease-out" style="width: 0%"></div>
                </div>
                <span id="progressText" class="text-sm text-slate-500 font-medium">Ready to start your journey!</span>
            </div>
        </header>

        <!-- Chat Container -->
        <div class="lg:col-span-2 bg-white/90 backdrop-blur-md rounded-2xl shadow-xl border border-white/20 flex flex-col overflow-hidden">
            <!-- Messages -->
            <div id="chatMessages" class="flex-1 p-6 overflow-y-auto max-h-96 lg:max-h-[500px] space-y-4">
                <div class="flex justify-start">
                    <div class="max-w-xs lg:max-w-md bg-slate-100 text-slate-800 p-4 rounded-2xl rounded-bl-md shadow-sm border">
                        <p class="mb-2">Hi! I'm the Family compatibility assistant. I'll help you find meaningful family planning connections based on your values, goals, and preferences.</p>
                        <p>This is a demo showcasing explainable AI for compatibility matching. Ready to get started?</p>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="p-4 bg-slate-50 border-t border-slate-200 flex gap-3">
                <input 
                    type="text" 
                    id="userInput" 
                    placeholder="Type your message here..." 
                    disabled
                    class="flex-1 px-4 py-3 border-2 border-slate-200 rounded-full focus:border-indigo-500 focus:outline-none disabled:bg-slate-100 disabled:text-slate-400 transition-colors"
                >
                <button 
                    id="sendButton" 
                    disabled
                    class="px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-full font-semibold hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 hover:scale-105 active:scale-95"
                >
                    Send
                </button>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="space-y-6">
            <!-- Demo Controls -->
            <div class="bg-white/90 backdrop-blur-md p-6 rounded-2xl shadow-xl border border-white/20">
                <h3 class="text-xl font-bold text-slate-800 mb-4 bg-gradient-to-r from-orange-500 to-red-500 bg-clip-text text-transparent">
                    Demo Controls
                </h3>
                
                <div class="space-y-3">
                    <button id="startDemo" class="w-full px-4 py-3 bg-white border-2 border-slate-200 text-slate-700 rounded-xl font-semibold hover:bg-indigo-500 hover:text-white hover:border-indigo-500 transition-all duration-300 hover:scale-105">
                        Start Onboarding Demo
                    </button>
                    <button id="skipToMatching" class="w-full px-4 py-3 bg-white border-2 border-slate-200 text-slate-700 rounded-xl font-semibold hover:bg-purple-500 hover:text-white hover:border-purple-500 transition-all duration-300 hover:scale-105">
                        Skip to Matching Demo
                    </button>
                    <button id="resetChat" class="w-full px-4 py-3 bg-white border-2 border-slate-200 text-slate-700 rounded-xl font-semibold hover:bg-pink-500 hover:text-white hover:border-pink-500 transition-all duration-300 hover:scale-105">
                        Reset Chat
                    </button>
                </div>
                
                <!-- Status Indicator -->
                <div class="mt-4 flex items-center justify-center p-3 bg-slate-100 rounded-xl">
                    <div id="statusLight" class="w-3 h-3 rounded-full bg-slate-400 mr-2 transition-all duration-300"></div>
                    <span id="statusText" class="text-sm font-medium text-slate-600">Ready</span>
                </div>
            </div>

            <!-- Info Panel -->
            <div class="bg-white/90 backdrop-blur-md p-6 rounded-2xl shadow-xl border border-white/20">
                <h3 class="text-xl font-bold text-slate-800 mb-4 bg-gradient-to-r from-green-500 to-emerald-500 bg-clip-text text-transparent">
                    Demo Features
                </h3>
                
                <div class="space-y-3">
                    <div class="p-3 bg-slate-50 rounded-xl border-l-4 border-green-500 hover:bg-slate-100 transition-colors">
                        <span class="font-semibold text-slate-800">Values-Based Matching:</span>
                        <span class="text-slate-600"> Rule-based scoring system</span>
                    </div>
                    <div class="p-3 bg-slate-50 rounded-xl border-l-4 border-purple-500 hover:bg-slate-100 transition-colors">
                        <span class="font-semibold text-slate-800">Conversational Interface:</span>
                        <span class="text-slate-600"> Natural dialogue flow</span>
                    </div>
                    <div class="p-3 bg-slate-50 rounded-xl border-l-4 border-pink-500 hover:bg-slate-100 transition-colors">
                        <span class="font-semibold text-slate-800">Real-time Compatibility:</span>
                        <span class="text-slate-600"> Dynamic scoring algorithms</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        /**
         * Family Compatibility Chatbot Demo
         * 
         * This JavaScript implements a demo interface that simulates the experience
         * of using a Dialogflow-powered compatibility chatbot. The demo shows what
         * the user experience would look like without requiring actual Dialogflow setup.
         * 
         * Architecture:
         * - CompatibilityChatbot class manages all chat interactions
         * - Demo controls allow testing different conversation flows
         * - Hardcoded responses simulate real backend processing
         * - Progress tracking shows conversation advancement
         * 
         * In a real implementation, this would connect to the Flask backend
         * which communicates with Dialogflow for natural language processing.
         */
        
        /**
         * Main chatbot interface class
         * 
         * Handles all user interactions, conversation flow, and demo controls
         * for the family planning compatibility chatbot demo.
         * 
         * Key Responsibilities:
         * - Managing conversation state and progress
         * - Processing user input and generating responses
         * - Controlling UI elements (buttons, progress bar, status)
         * - Simulating realistic chatbot behavior with delays and animations
         */
        class CompatibilityChatbot {
            constructor() {
                // Get references to all DOM elements we'll need to manipulate
                this.chatMessages = document.getElementById('chatMessages');
                this.userInput = document.getElementById('userInput');
                this.sendButton = document.getElementById('sendButton');
                this.startDemo = document.getElementById('startDemo');
                this.skipToMatching = document.getElementById('skipToMatching');
                this.resetChat = document.getElementById('resetChat');
                this.progressBar = document.getElementById('progressBar');
                this.progressText = document.getElementById('progressText');
                this.statusLight = document.getElementById('statusLight');
                this.statusText = document.getElementById('statusText');
                
                // Initialize session tracking variables
                // In real implementation, this would be managed by the backend
                this.sessionId = 'demo_session_' + Math.random().toString(36).substr(2, 9);
                this.currentStep = 'welcome';    // Current conversation step
                this.totalSteps = 8;            // Total onboarding steps for progress calculation
                this.currentProgress = 0;       // Progress through onboarding (0-8)
                
                // Set up event listeners and initial state
                this.initializeEventListeners();
                this.updateStatus('Ready', 'ready');
            }
            
            /**
             * Set up all event listeners for user interactions
             * 
             * This includes:
             * - Send button clicks and Enter key presses for chat input
             * - Demo control button clicks for different demo flows
             */
            initializeEventListeners() {
                // Chat input handlers - allow sending messages via button or Enter key
                this.sendButton.addEventListener('click', () => this.sendMessage());
                this.userInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.sendMessage();
                });
                
                // Demo control handlers - different entry points into the demo
                this.startDemo.addEventListener('click', () => this.startOnboardingDemo());
                this.skipToMatching.addEventListener('click', () => this.skipToMatchingDemo());
                this.resetChat.addEventListener('click', () => this.resetChatDemo());
            }
            
            /**
             * Start the full onboarding demo from the beginning
             * 
             * This simulates a user starting fresh and going through
             * the complete data collection process.
             */
            startOnboardingDemo() {
                this.enableChat();
                this.addBotMessage("Great! Let's start with your onboarding. What's your name?");
                this.currentStep = 'collect_name';
                this.updateProgress(1, "Collecting basic information...");
                this.updateStatus('Active', 'active');
            }
            
            /**
             * Skip directly to the matching demo
             * 
             * This simulates a user who has already completed onboarding
             * and wants to see compatibility matches immediately.
             */
            skipToMatchingDemo() {
                this.enableChat();
                this.simulateOnboardingComplete();
                this.addBotMessage("Perfect! I've collected all your information. Your profile is now complete. Would you like me to find some compatible matches for you?");
                this.currentStep = 'find_matches';
                this.updateProgress(7, "Ready to find matches!");
                this.updateStatus('Ready for Matching', 'active');
            }
            
            /**
             * Reset the chat demo to initial state
             * 
             * Clears all messages, resets progress, and returns to
             * the welcome state for starting over.
             */
            resetChatDemo() {
                // Reset chat messages to initial welcome message
                this.chatMessages.innerHTML = `
                    <div class="flex justify-start">
                        <div class="max-w-xs lg:max-w-md bg-slate-100 text-slate-800 p-4 rounded-2xl rounded-bl-md shadow-sm border">
                            <p class="mb-2">Hi! I'm the Family compatibility assistant. I'll help you find meaningful family planning connections based on your values, goals, and preferences.</p>
                            <p>This is a demo showcasing explainable AI for compatibility matching. Ready to get started?</p>
                        </div>
                    </div>
                `;
                this.disableChat();
                this.currentStep = 'welcome';
                this.sessionId = 'demo_session_' + Math.random().toString(36).substr(2, 9);
                this.updateProgress(0, "Ready to start your journey!");
                this.updateStatus('Ready', 'ready');
            }
            
            /**
             * Enable chat input controls
             * 
             * Allows user to type and send messages by enabling
             * the input field and send button.
             */
            enableChat() {
                this.userInput.disabled = false;
                this.sendButton.disabled = false;
                this.userInput.focus(); // Automatically focus input for better UX
            }
            
            /**
             * Disable chat input controls
             * 
             * Prevents user input when chat is not active by
             * disabling the input field and send button.
             */
            disableChat() {
                this.userInput.disabled = true;
                this.sendButton.disabled = true;
            }
            
            /**
             * Handle user message sending
             * 
             * Process user input, display the message, and generate
             * an appropriate bot response based on current conversation state.
             */
            sendMessage() {
                const message = this.userInput.value.trim();
                if (!message) return; // Don't send empty messages
                
                this.addUserMessage(message);
                this.userInput.value = ''; // Clear input field
                this.updateStatus('Processing...', 'processing');
                
                // Simulate realistic processing delay before response
                // In real implementation, this would be actual API call time
                setTimeout(() => {
                    this.processMessage(message);
                    this.updateStatus('Active', 'active');
                }, 800);
            }
            
            /**
             * Update progress bar and text
             * 
             * Visual feedback showing user how far through the
             * onboarding process they've progressed.
             * 
             * @param {number} step - Current step number (0-8)
             * @param {string} text - Descriptive text for current stage
             */
            updateProgress(step, text) {
                this.currentProgress = step;
                const percentage = (step / this.totalSteps) * 100;
                this.progressBar.style.width = percentage + '%';
                this.progressText.textContent = text;
            }
            
            /**
             * Update status indicator with text and visual state
             * 
             * Provides real-time feedback about the chatbot's current state
             * with both text and a colored status light.
             * 
             * @param {string} text - Status text to display
             * @param {string} type - Status type: 'ready', 'active', 'processing'
             */
            updateStatus(text, type) {
                this.statusText.textContent = text;
                
                // Remove existing classes to reset styling
                this.statusLight.className = 'w-3 h-3 rounded-full transition-all duration-300';
                
                // Add appropriate styling based on status type
                switch(type) {
                    case 'ready':
                        this.statusLight.classList.add('bg-slate-400'); // Gray for inactive
                        break;
                    case 'active':
                        this.statusLight.classList.add('bg-green-500', 'animate-pulse'); // Green pulsing for active
                        break;
                    case 'processing':
                        this.statusLight.classList.add('bg-orange-500', 'animate-bounce'); // Orange bouncing for processing
                        break;
                }
            }
            
            /**
             * Add a user message to the chat display
             * 
             * Creates a message bubble styled for user messages
             * (right-aligned with blue gradient background).
             * 
             * @param {string} message - The user's message text
             */
            addUserMessage(message) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'flex justify-end';
                messageDiv.innerHTML = `
                    <div class="max-w-xs lg:max-w-md bg-gradient-to-r from-indigo-500 to-purple-500 text-white p-4 rounded-2xl rounded-br-md shadow-sm">
                        <p>${message}</p>
                    </div>
                `;
                this.chatMessages.appendChild(messageDiv);
                this.scrollToBottom();
            }
            
            /**
             * Format bot messages for proper HTML display
             * 
             * Converts plain text formatting to HTML elements for better
             * message display in the chat interface.
             * 
             * Conversions:
             * - Line breaks (\n) become <br> tags
             * - Markdown bold (**text**) becomes <strong> tags
             * 
             * @param {string} message - Raw message text with formatting
             * @returns {string} HTML-formatted message
             */
            formatMessage(message) {
                // Convert line breaks to HTML
                let formatted = message.replace(/\n/g, '<br>');
                
                // Convert markdown bold to HTML
                formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                
                return formatted;
            }
            
            /**
             * Add a bot message to the chat with typing animation
             * 
             * Creates a realistic chat experience by:
             * 1. First showing typing indicator (three bouncing dots)
             * 2. After delay, replacing with actual formatted message
             * 
             * This simulates the experience of chatting with a real person
             * who takes time to type their response.
             * 
             * @param {string} message - The bot's message text
             */
            addBotMessage(message) {
                // Show typing indicator first to simulate bot "thinking/typing"
                const typingDiv = document.createElement('div');
                typingDiv.className = 'flex justify-start typing-message';
                typingDiv.innerHTML = `
                    <div class="max-w-xs lg:max-w-md bg-slate-100 text-slate-800 p-4 rounded-2xl rounded-bl-md shadow-sm border">
                        <div class="flex space-x-1">
                            <div class="w-2 h-2 bg-slate-400 rounded-full animate-bounce"></div>
                            <div class="w-2 h-2 bg-slate-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                            <div class="w-2 h-2 bg-slate-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                        </div>
                    </div>
                `;
                this.chatMessages.appendChild(typingDiv);
                this.scrollToBottom();
                
                // Replace typing indicator with actual message after realistic delay
                setTimeout(() => {
                    this.chatMessages.removeChild(typingDiv);
                    
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'flex justify-start';
                    const formattedMessage = this.formatMessage(message);
                    messageDiv.innerHTML = `
                        <div class="max-w-xs lg:max-w-md bg-slate-100 text-slate-800 p-4 rounded-2xl rounded-bl-md shadow-sm border">
                            <div>${formattedMessage}</div>
                        </div>
                    `;
                    this.chatMessages.appendChild(messageDiv);
                    this.scrollToBottom();
                }, 1200); // 1.2 second delay for realistic typing effect
            }
            
            /**
             * Scroll chat container to show latest messages
             * 
             * Ensures users always see the most recent message by
             * scrolling to the bottom of the chat container.
             */
            scrollToBottom() {
                this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
            }
            
            /**
             * Process user message and generate appropriate response
             * 
             * This is the core demo logic that simulates a real chatbot conversation.
             * In a real implementation, this would be replaced by API calls to the
             * Flask backend, which would communicate with Dialogflow.
             * 
             * The logic follows a state machine pattern:
             * - Each conversation step has specific expected responses
             * - User input advances to the next logical step
             * - Progress tracking shows advancement through onboarding
             * 
             * @param {string} message - The user's message to process
             */
            processMessage(message) {
                switch(this.currentStep) {
                    case 'collect_name':
                        // Simulate collecting user's name
                        this.addBotMessage(`Nice to meet you, ${message}! Now, what's your age?`);
                        this.currentStep = 'collect_age';
                        this.updateProgress(2, "Getting to know you...");
                        break;
                        
                    case 'collect_age':
                        // Simulate collecting user's age
                        this.addBotMessage("Thanks! And what city are you located in?");
                        this.currentStep = 'collect_location';
                        this.updateProgress(3, "Almost done with basics...");
                        break;
                        
                    case 'collect_location':
                        // Transition from basic info to values assessment
                        this.addBotMessage("Great! Now let's talk about your values. For each value, tell me how important it is to you on a scale of 1-5, where 5 is extremely important. How important is putting family first in your life decisions?");
                        this.currentStep = 'collect_values';
                        this.updateProgress(4, "Exploring your values...");
                        break;
                        
                    case 'collect_values':
                        // Simulate values collection (in real app, would collect all 8 values)
                        this.addBotMessage("Perfect! Now, what are your main family planning goals? You can mention things like biological children, adoption, co-parenting, etc.");
                        this.currentStep = 'collect_goals';
                        this.updateProgress(5, "Understanding your family goals...");
                        break;
                        
                    case 'collect_goals':
                        // Collect family planning goals
                        this.addBotMessage("Got it! How would you describe your communication style? Are you more direct and honest, gentle and supportive, analytical and logical, emotional and expressive, or collaborative and consensus-building?");
                        this.currentStep = 'collect_communication';
                        this.updateProgress(6, "Learning your communication style...");
                        break;
                        
                    case 'collect_communication':
                        // Collect communication style preferences
                        this.addBotMessage("Perfect! Finally, what's your preferred timeline for starting a family? Within 1 year, 1-3 years, 3-5 years, 5+ years, or are you flexible?");
                        this.currentStep = 'collect_timeline';
                        this.updateProgress(7, "Almost complete...");
                        break;
                        
                    case 'collect_timeline':
                        // Complete onboarding and offer matching
                        this.addBotMessage("Perfect! I've collected all your information. Your profile is now complete. Would you like me to find some compatible matches for you?");
                        this.currentStep = 'find_matches';
                        this.updateProgress(8, "Profile complete - ready to match!");
                        break;
                        
                    case 'find_matches':
                        // Show demo compatibility matches
                        this.showDemoMatches();
                        this.currentStep = 'explain_matches';
                        this.updateStatus('Matches Found!', 'active');
                        break;
                        
                    case 'explain_matches':
                        // Provide detailed explanation of matches
                        this.showDetailedExplanation();
                        this.currentStep = 'complete';
                        this.updateStatus('Demo Complete!', 'active');
                        break;
                        
                    case 'complete':
                        // Demo is finished
                        this.addBotMessage("Thanks for trying the demo! This shows how Dialogflow can work with explainable AI for compatibility matching. You can reset to try again or explore different responses.");
                        break;
                        
                    default:
                        // Fallback for unrecognized states
                        this.addBotMessage("I'm not sure how to respond to that. Try using the demo controls to get started!");
                }
            }
            
            /**
             * Simulate completion of onboarding process
             * 
             * Used by the "Skip to Matching" demo to bypass
             * the data collection phase and jump directly to results.
             */
            simulateOnboardingComplete() {
                this.currentStep = 'find_matches';
            }
            
            /**
             * Display demo compatibility matches
             * 
             * Shows hardcoded sample matches that demonstrate what
             * the real compatibility algorithm would produce. Includes:
             * - Match names, ages, and locations
             * - Compatibility percentages
             * - Brief explanations for each match
             */
            showDemoMatches() {
                const matchesResponse = `Great! I found some compatible matches for you:

1. Sarah (Age 32) - 87% compatibility
   Location: Seattle, WA
   Why it's a good match: Strong alignment on core values; highly compatible family goals; complementary communication styles; aligned timing preferences.

2. Michael (Age 29) - 73% compatibility  
   Location: Portland, OR
   Why it's a good match: Some shared core values; some compatible family goals; workable communication differences; different timeline expectations.

3. Jessica (Age 35) - 64% compatibility
   Location: San Francisco, CA
   Why it's a good match: Different value priorities; some shared family aspirations; potentially challenging communication dynamics; different timeline expectations.

Would you like me to explain any of these matches in more detail?`;
                
                this.addBotMessage(matchesResponse);
            }
            
            /**
             * Show detailed explanation of a compatibility match
             * 
             * Demonstrates the explainable AI feature by providing:
             * - Overall compatibility assessment
             * - Breakdown by compatibility dimensions
             * - Specific strengths and considerations
             * - Suggested next steps for the relationship
             * 
             * This showcases how the real system provides transparency
             * in its recommendations rather than just black-box scores.
             */
            showDetailedExplanation() {
                const explanationResponse = `Here's a detailed explanation of your top match with Sarah:

**Overall Assessment:** Excellent compatibility - This match shows strong potential for a successful family partnership.

**Strengths:**
• Strong alignment on core life values
• Shared vision for family structure and goals  
• Compatible communication and conflict resolution styles
• Aligned timeline for family planning

**Detailed Breakdown:**
• Values Compatibility (0.87): You both prioritize similar life values and principles
• Family Goals Alignment (0.92): Your family planning goals are highly aligned
• Communication Compatibility (0.78): Your communication styles complement each other well
• Timeline Alignment (0.85): Your family planning timelines align well

**Next Steps:**
• Schedule a video call to explore your connection further
• Discuss your family planning timeline in detail
• Share more about your personal backgrounds and experiences

This analysis helps you understand the foundation for a potential partnership. The explainable AI ensures you know exactly why this match was recommended!`;
                
                this.addBotMessage(explanationResponse);
            }
        }
        
        // Initialize the chatbot when the page loads
        // This ensures all DOM elements are available before creating the chatbot instance
        document.addEventListener('DOMContentLoaded', () => {
            new CompatibilityChatbot();
        });
    </script>
</body>
</html>
